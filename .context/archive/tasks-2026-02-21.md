# Archived Tasks - 2026-02-21

- [x] Investigate PreToolUse:Edit hook not firing — qa-reminder (hooks.json:10) should fire on every Edit call but zero PreToolUse:Edit entries appeared in session JSONL despite 6+ Edit calls. Installed ctx v0.6.4 matches assets. Check: hooks sync to active config, matcher dispatch for Edit, session 8b80f8e6. #priority:high #added:2026-02-20-150011
- [x] Human: there are still minor render issues in journal site.
      Collaborate with AI to sort them out.
- [x] Update enrich-all skill: remove normalize-first prerequisite #priority:medium #added:2026-02-20-062259
- [x] Move 'ctx journal mark' to 'ctx system mark-journal' #priority:medium #added:2026-02-20-015721
- [x] AI: human renamed a skill as "audit" docs may need update
- [x] P5.8: `ctx system check-knowledge` hook — VERBATIM nudge when DECISIONS.md
      or LEARNINGS.md exceed entry count thresholds (configurable via `.contextrc`
      `entry_count_decisions` / `entry_count_learnings`). Daily throttle.
      #priority:medium #added:2026-02-21 #done:2026-02-21
- [x] P5.9: Remove archive code — deleted `decisions archive`, `learnings archive`,
      `compact --archive` knowledge block, `.contextrc` archive fields, `RemoveEntryBlocks`,
      `OlderThan`. Updated docs and conventions.
      #priority:medium #added:2026-02-21 #done:2026-02-21
- [x] T2.1: Safe-by-default export — change `--all` to only export new
      sessions (skip existing files). Deprecate `--skip-existing` (now the
      default). Single-session `export <id>` always writes (explicit intent).
      Files: `internal/cli/recall/cmd.go`, `run.go`
      #priority:high #added:2026-02-21 #done:2026-02-21
- [x] T2.2: `--regenerate` flag — add flag to opt in to re-exporting
      existing sessions. `--regenerate` without `--all` is an error.
      `--keep-frontmatter=false` implies `--regenerate`.
      Files: `internal/cli/recall/cmd.go`, `run.go`
      #priority:high #added:2026-02-21 #done:2026-02-21
- [x] T2.3: Confirmation prompt — before destructive writes, compute plan
      (new/regenerate/locked counts), print summary, prompt `proceed? [y/N]`.
      Add `--yes`/`-y` flag to bypass. New-only exports skip confirmation.
      `--dry-run` prints summary and exits (no prompt, no writes).
      Files: `internal/cli/recall/run.go`, `cmd.go`
      #priority:high #added:2026-02-21 #done:2026-02-21
- [x] T2.4: Lock/unlock state layer — add `Locked` field to `FileState`,
      `MarkLocked()`, `ClearLocked()`, `IsLocked()`, add `"locked"` to
      `Mark()` and `ValidStages`. Tests: mark/clear/round-trip/no-op.
      Files: `internal/journal/state/state.go`, `state_test.go`
      #priority:medium #added:2026-02-20 #done:2026-02-21
- [x] T2.5: Lock/unlock CLI commands — `ctx recall lock <pattern>` and
      `ctx recall unlock <pattern>` with `--all`. Reuse slug/date/id
      matching from export. Multi-part: locking base locks all `-pN` parts.
      Frontmatter: insert/remove `locked: true  # managed by ctx`.
      `.state.json` is source of truth; frontmatter for human visibility.
      File: new `internal/cli/recall/lock.go`, register in `recall.go`
      #priority:medium #added:2026-02-20 #done:2026-02-21
- [x] T2.6: Export respects locks — skip locked files with log line and
      counter. Neither `--regenerate` nor `--force` overrides locks (require
      explicit unlock). Add `locked` counter to confirmation summary.
      File: `internal/cli/recall/run.go`
      #priority:medium #added:2026-02-20 #done:2026-02-21
- [x] T2.7: Replace `--force` with `--keep-frontmatter` — add
      `--keep-frontmatter` flag (bool, default `true`). Keep `--force` as
      deprecated alias via `cmd.Flags().MarkDeprecated`. Logic:
      `discardFrontmatter := !keepFrontmatter || force`.
      `--keep-frontmatter=false` implies `--regenerate`.
      Files: `internal/cli/recall/cmd.go`, `run.go`
      #priority:medium #added:2026-02-20 #done:2026-02-21
- [x] T2.8: Ergonomics — bare `ctx recall export` prints help (not error).
      Files: `internal/cli/recall/cmd.go`, `run.go`
      #priority:medium #added:2026-02-20 #done:2026-02-21
- [x] T2.9: Tests — safe-default, --regenerate, confirmation, --yes,
      --dry-run, lock/export integration (locked skipped by default, by
      --force, dry-run shows locked), --keep-frontmatter=false, default
      preservation. 16 lock tests in `lock_test.go`, 7 new export tests
      in `run_test.go`, 4 `discardFrontmatter()` unit tests.
      Files: `internal/cli/recall/run_test.go`, `lock_test.go`, `recall_test.go`
      #priority:medium #added:2026-02-21 #done:2026-02-21
- [x] T2.10: Documentation — updated cli-reference (lock/unlock sections,
      --keep-frontmatter flag, removed --force from table), session-journal
      (--keep-frontmatter=false, lock mention), session-archaeology recipe
      (updated warning), recall skill (lock/unlock subcommands, flag update).
      #priority:low #added:2026-02-21 #done:2026-02-21
