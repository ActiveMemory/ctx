# Archived Tasks - 2026-02-28

- [x] P0.9.1: Create `internal/cli/system/mark_wrapped_up.go` — hidden plumbing
      command `ctx system mark-wrapped-up`. Writes a `ctx-wrapped-up` marker file
      to `secureTempDir()`. No flags, no arguments, no stdin. Follow the
      `mark-journal` pattern.
      DOD: `ctx system mark-wrapped-up` creates the marker file. Running it twice
      overwrites (idempotent). Unit test confirms file creation and mtime update.
      #added:2026-02-28 #done:2026-02-28
- [x] P0.9.2: Register `markWrappedUpCmd()` in `system.go` — add to
      `cmd.AddCommand()` and update the Long description under plumbing section.
      DOD: `ctx system mark-wrapped-up` is callable. `ctx system --help` lists it
      (hidden, but callable). #added:2026-02-28 #done:2026-02-28
- [x] P0.9.3: Modify `check_context_size.go` — before emitting a checkpoint,
      check for the `ctx-wrapped-up` marker in `secureTempDir()`. If the marker
      exists and is less than 2 hours old, suppress the nudge and log
      `"prompt#N suppressed (wrapped up)"`. If the marker is expired (>2h),
      ignore it.
      DOD: Unit test confirms: nudge suppressed when marker is fresh, nudge fires
      when marker is expired (>2h), nudge fires when marker is absent. Existing
      check-context-size tests still pass. #added:2026-02-28 #done:2026-02-28
- [x] P0.9.4: Update `/ctx-wrap-up` skill — add `ctx system mark-wrapped-up`
      call after Phase 3 (persist approved candidates). Single line addition.
      DOD: Skill file contains the mark command. #added:2026-02-28 #done:2026-02-28
- [x] P0.8.1: Create `internal/cli/site/` package with `site.go` parent command
      — register `ctx site` as a Cobra command in bootstrap. Command should have
      no run function (parent only), short description, and long help text.
      DOD: `ctx site` prints help with "feed" listed as a subcommand. `ctx site --help`
      works. Package registered in `internal/bootstrap/bootstrap.go`.
      #added:2026-02-28 #done:2026-02-28
- [x] P0.8.2: Create `internal/cli/site/atom.go` with Atom XML types — AtomFeed,
      AtomEntry, AtomLink, AtomAuthor, AtomCategory structs with xml tags per spec.
      DOD: Types compile. `xml.Marshal` of a hand-built AtomFeed produces valid
      Atom 1.0 XML matching the spec's example structure. Unit test confirms
      round-trip. #added:2026-02-28 #done:2026-02-28
- [x] P0.8.3: Implement `scanBlogPosts()` in `internal/cli/site/feed.go` — scans
      `docs/blog/*.md` for files matching `YYYY-MM-DD-*.md`, parses YAML frontmatter,
      extracts summary from first paragraph after `#` heading, applies draft gate
      (`reviewed_and_finalized: true`), returns `[]blogPost` and `feedReport`.
      DOD: Unit tests pass for: finalized posts included, drafts skipped, missing
      title/date skipped with warning, missing summary warns but includes, malformed
      YAML skipped with warning, non-matching filenames ignored. #added:2026-02-28 #done:2026-02-28
- [x] P0.8.4: Implement `generateAtom()` in `internal/cli/site/feed.go` — takes
      `[]blogPost` and config (base URL, output path), sorts by date descending,
      builds AtomFeed struct, marshals to indented XML with `<?xml?>` declaration,
      writes to output path (creating parent dirs if needed).
      DOD: Unit tests pass for: valid Atom output with correct entry count, sort
      order (newest first), empty blog produces valid empty feed, custom base URL
      reflected in all links and IDs. Output is idempotent (same input = same output).
      #added:2026-02-28 #done:2026-02-28
- [x] P0.8.5: Implement `feedCmd()` in `internal/cli/site/feed.go` — Cobra command
      with `--out` (`-o`, default `site/feed.xml`) and `--base-url` (default
      `https://ctx.ist`) flags. Calls `scanBlogPosts()` then `generateAtom()`,
      prints three-bucket report (included count, skipped with reasons, warnings).
      Exit 0 on success/warnings, exit 1 only for fatal errors (no blog dir,
      can't write output).
      DOD: `ctx site feed` generates `site/feed.xml` from real blog posts.
      `ctx site feed --out /tmp/test.xml --base-url https://example.com` works.
      Output matches spec's example format. Report prints to stdout. #added:2026-02-28 #done:2026-02-28
- [x] P0.8.6: Write full test suite in `internal/cli/site/feed_test.go` — cover
      all 12 scenarios from spec: TestFeed_Basic, TestFeed_SkipsDrafts,
      TestFeed_MissingTitle, TestFeed_MissingDate, TestFeed_NoSummary,
      TestFeed_EmptyBlog, TestFeed_SortOrder, TestFeed_MalformedFrontmatter,
      TestFeed_Idempotent, TestFeed_Categories, TestFeed_CustomBaseURL,
      TestFeed_FilenameFilter. Use temp dirs with constructed blog entries.
      DOD: All 12 tests pass. `go test ./internal/cli/site/... -v` green.
      #added:2026-02-28 #done:2026-02-28
- [x] P0.8.7: Add Makefile integration — add `site-feed` target that runs
      `ctx site feed` after site build. Update `make site` (or equivalent) to
      include feed generation as a post-build step.
      DOD: `make site` produces `site/feed.xml`. Feed is valid XML (passes
      `xmllint --noout site/feed.xml`). #added:2026-02-28 #done:2026-02-28
- [x] P0.8.8: Verify end-to-end with real blog content — run against actual
      `docs/blog/` posts, confirm correct entries included, drafts excluded,
      URLs resolve, feed validates.
      DOD: `site/feed.xml` committed with correct entries. Feed opened in a
      reader or validated online. `make lint` and `go test ./...` pass.
      #added:2026-02-28 #done:2026-02-28
- [x] P0.6.XX: Update CLI docs — add `ctx system events` section to
      `docs/cli/system.md` (flags table, examples, human/JSON output format).
      Create `docs/cli/doctor.md` for `ctx doctor` (command syntax, checks
      table, output examples, when-to-use guidance vs `ctx status` vs
      `/ctx-doctor`). Add `ctx doctor` row to `docs/cli/index.md` commands table.
      DOD: All three doc files updated. Command syntax matches implementation.
      Examples are copy-pasteable. Cross-links work. #added:2026-02-27
- [x] P0.6.XX: Update configuration docs — add `event_log` to `.ctxrc`
      reference table in `docs/home/configuration.md` (or equivalent `.ctxrc`
      section in `docs/cli/index.md`). Type: bool, default: false, description
      matches spec.
      DOD: `event_log` documented in the `.ctxrc` reference table. #added:2026-02-27
- [x] P0.6.XX: Add `/ctx-doctor` entry to `docs/reference/skills.md` — name,
      description, trigger phrases.
      DOD: Skill listed with description and trigger phrases matching SKILL.md.
      #added:2026-02-27
- [x] P0.6.XX: Update existing recipes — add event logging mentions to
      `docs/recipes/system-hooks-audit.md` (local alternative to Sheets),
      `docs/recipes/context-health.md` (`ctx doctor` as superset of drift),
      `docs/recipes/webhook-notifications.md` (local complement to webhooks).
      DOD: Each recipe has a paragraph or section mentioning the new feature
      with cross-link to the troubleshooting recipe. No broken links.
      #added:2026-02-27
- [x] P0.6.XX: Create `docs/recipes/troubleshooting.md` recipe — The Problem,
      TL;DR, Commands and Skills table, workflow sections (quick check with
      `ctx doctor`, deep dive with `/ctx-doctor`, raw event inspection),
      Common Problems section (hook not firing, too many nudges, stale context,
      agent not following instructions), prerequisites, See Also links.
      DOD: Recipe follows existing recipe structure (title, icon, banner, TL;DR,
      commands table, workflow steps, tips, see also). Common Problems section
      has 4 subsections with concrete diagnostic steps. #added:2026-02-27
- [x] P0.6.XX: Update `docs/recipes/index.md` — add Troubleshooting entry
      under Maintenance section. Update `zensical.toml` — add nav entries for
      `docs/cli/doctor.md` and `docs/recipes/troubleshooting.md`.
      DOD: Recipe index lists troubleshooting with description and uses list.
      `zensical.toml` has both new nav entries. Site builds without errors.
      #added:2026-02-27
